language: generic

go:
  - 1.12.x

os: linux
dist: bionic


before_install:
  - sudo apt-get -y install jq
  
script:
  - echo "TRAVIS_TAG=$TRAVIS_TAG";
  - if [ ! -z $TRAVIS_TAG ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
       echo "TRAVIS_TAG=$TRAVIS_TAG found and not empty.";
       echo "calling the build and push script..";
       . ./ci/publish_utils_image.sh;
    else
       echo "It is not a tagged commit or, the TRAVIS_TAG=$TRAVIS_TAG is empty";
    fi
# note before_deploy will run before each deploy provider
before_deploy:
  - . ./ci/package.sh

deploy:
  provider: releases
  skip_cleanup: true
  api_key: $GITHUB_TOKEN
  file: ci/assets/*
  file_glob: true
  on:
    tags: true
    repo: $GITHUB_REPO/kabanero-pipelines
